<link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons.css">
<link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/themes/smoothness/jquery-ui.css" />
<style>
</style>
<div class="block" id="button-bar" style="margin-top: 15px;">
      <button class="blue" id="run-sefaria" style="margin-left: 10px;">Insert Text</button>
      <select class="parshah" style="margin-left: 12px;">
             <option value = "7"selected>Insert Aliyah</option>
             <option value = "0">Aliyah 1</option>
             <option value = "1">Aliyah 2</option>
             <option value = "2">Aliyah 3</option>
             <option value = "3">Aliyah 4</option>
             <option value = "4">Aliyah 5</option>
             <option value = "5">Aliyah 6</option>
             <option value = "6">Aliyah 7</option>
       </select>
      
      <a href="http://www.sefaria.org/texts">
      <button id="text-directory" style="float:right;">Show Texts</button>
      </a>
    </div>
<input type="text" class="textRef disab" style="margin-top: 20px; margin-left: 10px; width: 280px;" placeholder="Text">
<div class="suggestions" style="margin-left: 10px;">
<br>
Loading...
</div>
<div class="sidebar bottom" style="position: fixed; background: white;">

<span class="gray branding-text">Sefaria AddOn by <a href="http://www.github.com/shman/">Shlomi Helfgot</a> &nbsp; </span>
</div>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
</script>
<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>
<script>
$(".textRef").attr("disabled",true);
google.script.run.withSuccessHandler(function(respo) {
    var sefTitles = [];
    sefTitles=respo;
     $(".textRef").removeAttr("disabled");
    $('.suggestions').html("<br><b>Enter source title.</b>");
    $('.textRef').autocomplete({
              source: function( request, response ) {
				var matches = $.map(sefTitles, function(tag) {
						if ( tag.toUpperCase().indexOf(request.term.toUpperCase()) === 0 ) {
							return tag;
						}
					});
				response(matches);
               },
               close: function() {
               
               }
              });
    $('.blue').click(function() {
         var input = $('.textRef').val();
         google.script.run.findRef(input, true);
         var parshah = $('.parshah').val();
         google.script.run.parshaIn(parshah);
         });
     $('.textRef').keyup(function(e) {
      var input = $('.textRef').val();
         if (e.keyCode === 13) {
            $('.blue').click();
         }
         google.script.run.withSuccessHandler(function(txt) {
            txt.heTitle = txt.heTitle || "לא מצאנו כלום בחפוש";
            txt.text = txt.text || "";
            txt.he = txt.he || "";
            $('.suggestions').html("<table style='font-size: 3.5vw;'><tr><td>"+input+"</td><td>"+txt.heTitle+"</td></tr><tr><td>"+txt.text+"</td><td style='text-direction:rtl;'>"+txt.he+"</td></tr></table>");
         }).findRef(input, false);
      
      });
   $('.close').click(function() {
     google.script.host.close();
  });
}).returnTitles();
</script>
